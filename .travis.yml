# https://docs.travis-ci.com/user/languages/rust/

language: rust

before_install:
  - rustup component add rustfmt
  - rustup component add clippy

script:
  - cargo fmt --verbose
  - cargo clippy --verbose
  - cargo build --verbose --all
  - cargo test --verbose --all 

rust:
  - stable
  - beta
  - nightly
jobs:
  allow_failures:
    - rust: nightly
  fast_finish: true

# https://docs.travis-ci.com/user/deployment/pages/
# https://docs.travis-ci.com/user/build-stages/matrix-expansion/
# https://docs.travis-ci.com/user/build-stages/deploy-github-releases/
jobs:
  include:
    - stage: GitHub Pages
      script:
        - cargo doc --no-deps
        - rm -rf public/
        - mkdir -p public/
        - mv target/doc* public/
        - touch public/.nojekyll
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
        target_branch: gh-pages
        local_dir: public
        verbose: true
        on: 
          branch: master